<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$FLEX is your life â€” Flexcoin</title>

  <!-- Favicon: ì‹¤ì œ íŒŒì¼ ìš°ì„  / ì—†ëŠ” ê²½ìš°ì—ë„ 404 ì•ˆ ë‚˜ë„ë¡ ë°ì´í„°URL ë°±ì—… -->
  <link rel="shortcut icon" href="/public/favicon.ico">
  <link rel="icon" href="/public/favicon.ico">
  <link rel="icon" type="image/svg+xml" href="/public/favicon.svg">
  <link rel="alternate icon" href="/favicon.ico">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3EğŸ’°%3C/text%3E%3C/svg%3E">

  <style>
    :root{
      --bg:#11100d; --card:#1b1915; --text:#eadfbb; --muted:#b9a97a;
      --gold:#f4cc4f; --chip:#3a331c; --border:rgba(255,255,255,.08);
      --topbar-h:64px;
    }
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Helvetica,Arial;
      overflow-x:hidden;max-width:100vw}
    body{padding-top:var(--topbar-h)}
    *{box-sizing:border-box} a{color:inherit;text-decoration:none}
    body.noscroll{overflow:hidden}

    /* Topbar fixed */
    .topbar{position:fixed;inset:0 0 auto 0;height:var(--topbar-h);
      display:flex;align-items:center;gap:.5rem;padding:.8rem 1rem;
      background:linear-gradient(180deg,rgba(0,0,0,.75),rgba(0,0,0,.35));
      backdrop-filter:blur(6px);z-index:9999;border-bottom:1px solid var(--border)}
    .brand{font-weight:800;color:var(--gold);white-space:nowrap}
    .spacer{flex:1}
    .btn{border:none;border-radius:.7rem;padding:.55rem .9rem;cursor:pointer;
      background:var(--gold);color:#000;font-weight:800;white-space:nowrap}
    .btn[disabled]{opacity:.45;cursor:not-allowed}
    .nav a{margin-left:.6rem;font-weight:700;color:var(--gold);opacity:.9}
    .nav a:hover{opacity:1}
    .lang{display:inline-flex;border-radius:.6rem;overflow:hidden;border:1px solid var(--border)}
    .lang button{min-width:40px;background:var(--chip);padding:.5rem .75rem;border:0;color:var(--text);cursor:pointer;font-weight:700}
    .lang button.active{background:var(--gold);color:#000;font-weight:800}
    @media(max-width:680px){.nav{display:none}}

    .wrap{max-width:1100px;margin:0 auto;padding:1rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;margin-top:1rem}
    .section-title{font-size:1.4rem;font-weight:900;margin:.4rem 0 1rem;color:var(--gold)}
    .muted{color:var(--muted);font-size:.95rem}

    .hero{background:#0f0e0c;border-radius:18px;overflow:hidden;border:1px solid var(--border)}
    .hero img{display:block;width:100%;height:auto}

    .tok-wrap{display:grid;grid-template-columns:320px 1fr;gap:18px}
    canvas{background:#0f0e0c;border-radius:14px}
    ul.legend{list-style:none;margin:0;padding:0}
    ul.legend li{margin:.2rem 0}
    #caps,#rates{margin-top:.35rem}
    #btn-pinksale{margin-top:12px;display:inline-block}

    .countbox{border:1px solid var(--border);border-radius:14px;padding:14px;
      background:linear-gradient(180deg,rgba(255,255,255,.02),transparent)}
    #countdown{font-weight:900;font-size:1.35rem}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .grid img{width:100%;aspect-ratio:16/9;object-fit:cover;border-radius:12px;border:1px solid var(--border);background:#0f0e0c}
    @media(max-width:900px){.tok-wrap{grid-template-columns:1fr}.grid{grid-template-columns:repeat(2,1fr)}}

    /* Roadmap */
    #roadmap .grid{grid-template-columns:repeat(4,1fr)}
    #roadmap .roadmap-card{transition:transform .25s ease, box-shadow .25s ease}
    #roadmap .roadmap-card:hover{transform:translateY(-4px); box-shadow:0 4px 15px rgba(212,175,55,.15)}

    /* NFT mint */
    .btn-row{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin-top:.6rem}
    .btn-gold{background:var(--gold);color:#000;border-radius:.7rem;padding:.55rem .9rem;font-weight:800;border:0;cursor:pointer}
    .select-net{margin:8px 0;padding:.45rem .6rem;border-radius:.6rem;border:1px solid var(--border);background:#0f0e0c;color:var(--text)}
    .mint-log{background:#0f0e0c;border:1px solid var(--border);border-radius:12px;padding:10px;margin-top:10px;color:#ddd;font-size:.85rem;min-height:2.2em}
  </style>

  <!-- ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.12.1/dist/ethers.umd.min.js"></script>
</head>
<body>
  <!-- Top bar -->
  <div class="topbar">
    <div class="brand" id="brand">$FLEX is your life. Your life is FLEX.</div>
    <div class="spacer"></div>
    <div class="nav">
      <a href="#about-flexcoin">About</a>
      <a href="#whitepaper">Whitepaper</a>
      <a href="#roadmap">Roadmap</a>
      <a href="#nft">NFT</a>
    </div>
    <a id="btn-x" class="btn" href="#" target="_blank" rel="noopener">X</a>
    <a id="btn-tg" class="btn" href="#" target="_blank" rel="noopener">Telegram</a>
    <a id="btn-pcs" class="btn" href="#" target="_blank" rel="noopener">Buy on PancakeSwap</a>
    <div class="lang" id="lang-pill"><button data-lang="en" class="active">EN</button><button data-lang="ko">KR</button></div>
  </div>

  <div class="wrap">
    <!-- HERO -->
    <section class="card hero">
      <img id="hero-img" src="/public/hero/main.jpg" alt="Flexcoin hero" onerror="this.onerror=null;this.src='/public/hero/1.jpg'">
    </section>

    <!-- About -->
    <section id="about-flexcoin" class="card">
      <div class="section-title">About FlexCoin</div>
      <div class="muted">ê°ì„± + ì‹ ë¢° ê²°í•© (Korean & English)</div>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px">
        <div class="card" style="margin:0">
          <h3 style="margin:0 0 8px 0">í•œêµ­ì–´</h3>
          <p>FlexCoinì€ ë‹¨ìˆœí•œ ë°ˆì½”ì¸ì´ ì•„ë‹™ë‹ˆë‹¤. í•œêµ­ì—ì„œ â€œFlexâ€ëŠ” <b>ìì‹ ì˜ ëŠ¥ë ¥Â·ì†Œë¹„ë ¥Â·ìì‹ ê°</b>ì„ ë‹¹ë‹¹í•˜ê²Œ í‘œí˜„í•˜ëŠ” ë¬¸í™”ì…ë‹ˆë‹¤. FlexCoinì€ ê·¸ íƒœë„ë¥¼ ë‹´ì€ <b>ë¼ì´í”„ìŠ¤íƒ€ì¼</b>ì…ë‹ˆë‹¤.</p>
          <blockquote style="margin:12px 0;border-left:4px solid rgba(212,175,55,.5);padding:8px 12px;color:#e9e1c8;font-style:italic">â€œFlexëŠ” ê³¼ì‹œê°€ ì•„ë‹ˆë¼, ë‹¹ì‹ ì˜ ì‚¶ì„ ì¦ëª…í•˜ëŠ” ê²ƒì´ë‹¤.â€</blockquote>
          <ul style="margin:8px 0 0 0">
            <li><b>íŒ€ ì‹ ì› KYC ì¸ì¦</b></li>
            <li><b>ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ Audit(ê°ì‚¬)</b></li>
            <li><b>ìœ ë™ì„± LP Lock + ì†Œìœ ê¶Œ í¬ê¸°</b></li>
            <li><b>Tokenomics Â· ì§€ê°‘ ë°°ë¶„ 100% ê³µê°œ</b></li>
          </ul>
        </div>
        <div class="card" style="margin:0">
          <h3 style="margin:0 0 8px 0">English</h3>
          <p>FlexCoin isnâ€™t just a memecoin. In Korea, â€œFlexâ€ means proudly expressing your <b>capability, spending power, and confidence</b>. FlexCoin captures that <b>lifestyle</b>.</p>
          <blockquote style="margin:12px 0;border-left:4px solid rgba(212,175,55,.5);padding:8px 12px;color:#e9e1c8;font-style:italic">â€œFlexing isnâ€™t showing off â€” itâ€™s owning your story.â€</blockquote>
          <ul style="margin:8px 0 0 0">
            <li><b>Team KYC Verified</b></li>
            <li><b>Smart Contract Audit Completed</b></li>
            <li><b>LP Locked + Ownership Renounced</b></li>
            <li><b>100% Public Tokenomics & Wallet Allocation</b></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Tokenomics -->
    <section class="card">
      <div class="section-title" data-i18n="section_tokenomics">Tokenomics</div>
      <div class="tok-wrap">
        <canvas id="donut" width="300" height="300"></canvas>
        <div>
          <ul class="legend" id="legend"></ul>
          <div id="caps" class="muted"></div>
          <div id="rates" class="muted"></div>
          <a id="btn-pinksale" class="btn" aria-disabled="true">Pinksale (coming soon)</a>
        </div>
      </div>
    </section>

    <!-- Countdown -->
    <section class="card">
      <div class="section-title">Presale Countdown</div>
      <div class="countbox"><div id="countdown">â€”</div><div id="countdown-range" class="muted">â€”</div></div>
    </section>

    <!-- Action & NFT -->
    <section class="card"><div class="section-title">Action Preview</div><div class="grid" id="action-grid"></div></section>
    <section class="card"><div class="section-title" data-i18n="nft.title">NFT Preview</div><div class="grid" id="nft-grid"></div></section>

    <!-- Whitepaper -->
    <section id="whitepaper" class="card">
      <div class="section-title">Whitepaper</div>
      <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:.5rem">
        <a class="btn" href="/public/whitepaper/en.pdf" download target="_blank" rel="noopener">English</a>
        <a class="btn" href="/public/whitepaper/ko.pdf" download target="_blank" rel="noopener">Korean</a>
        <a class="btn" href="/public/whitepaper/ja.pdf" download target="_blank" rel="noopener">Japanese</a>
        <a class="btn" href="/public/whitepaper/zh.pdf" download target="_blank" rel="noopener">Chinese</a>
        <a class="btn" href="/public/whitepaper/es.pdf" download target="_blank" rel="noopener">Spanish</a>
        <a class="btn" href="/public/whitepaper/de.pdf" download target="_blank" rel="noopener">German</a>
        <a class="btn" href="/public/whitepaper/pt.pdf" download target="_blank" rel="noopener">Portuguese</a>
        <a class="btn" href="/public/whitepaper/it.pdf" download target="_blank" rel="noopener">Italian</a>
      </div>
      <div class="muted" style="margin-top:.5rem">â€» ë‹¤ìš´ë¡œë“œê°€ ë§‰íˆë©´ ìƒˆ íƒ­ì—ì„œ ì—´ë¦¼ â†’ â€œë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥â€.</div>
    </section>

    <!-- Addresses -->
    <section class="card addr">
      <div class="section-title">Addresses</div>
      <table id="addr-table" style="width:100%;border-collapse:collapse;font-size:.92rem"></table>
    </section>

    <!-- Roadmap (i18n) -->
    <section id="roadmap" class="card">
      <div class="section-title" data-i18n="roadmap.title">Roadmap</div>
      <div class="grid">
        <div class="roadmap-card card">
          <div class="muted" data-i18n="roadmap.phase1.title">Phase 1</div>
          <div style="font-weight:800;margin-top:.2rem" data-i18n="roadmap.phase1.desc">Successful Launch & Survive in the Memecoin Sector</div>
        </div>
        <div class="roadmap-card card">
          <div class="muted" data-i18n="roadmap.phase2.title">Phase 2</div>
          <div style="font-weight:800;margin-top:.2rem" data-i18n="roadmap.phase2.desc">Community Activation & Achieve 1,000 Holders</div>
        </div>
        <div class="roadmap-card card">
          <div class="muted" data-i18n="roadmap.phase3.title">Phase 3</div>
          <div style="font-weight:800;margin-top:.2rem" data-i18n="roadmap.phase3.desc">DEX & CEX Exchange Listings</div>
        </div>
        <div class="roadmap-card card">
          <div class="muted" data-i18n="roadmap.phase4.title">Phase 4</div>
          <div style="font-weight:800;margin-top:.2rem" data-i18n="roadmap.phase4.desc">Ecosystem Expansion (AI & NFT)</div>
        </div>
      </div>
    </section>

    <!-- NFT MINT -->
    <section id="nft" class="card">
      <div class="section-title" data-i18n="section_nft">FLEX NFT MINT</div>
      <p class="muted" style="margin-top:-6px">Mint your official <b>FlexNFT</b> on BNB Smart Chain</p>
      <div style="text-align:center">
        <select id="net" class="select-net">
          <option value="bscMainnet">BNB Mainnet</option>
          <option value="bscTestnet">BNB Testnet</option>
        </select>
        <div class="btn-row">
          <button id="connect" class="btn-gold" data-i18n="connect">Connect Wallet</button>
          <button id="mint" class="btn-gold">Mint NFT (Legacy)</button>
          <button id="mint-flex" class="btn-gold">Mint FlexNFT (0.0001 BNB)</button>
        </div>
        <pre id="mint-log" class="mint-log">[ Waiting for connection... ]</pre>
      </div>
    </section>
  </div>

  <!-- Lightbox (omitted for brevity in style; works the same) -->
  <div class="lightbox" id="lightbox" aria-modal="true" role="dialog">
    <div class="lb-stage" id="lb-stage"><img id="lb-img" class="lb-img" alt="preview"></div>
    <div class="lb-hint">Wheel/í•€ì¹˜ í™•ëŒ€, ë“œë˜ê·¸ ì´ë™, ESC ë‹«ê¸°</div>
  </div>

  <script>
    const $ = q => document.querySelector(q);

    /* ---------- helpers ---------- */
    const deep = (obj, path) => path.split('.').reduce((o,k)=> (o && k in o) ? o[k] : undefined, obj);
    async function fetchFirst(paths){
      for(const p of paths){ try{ const r=await fetch(p,{cache:'no-cache'}); if(r.ok) return r.json(); }catch(_){} }
      return {};
    }
    function firstExistingImage(paths){
      return new Promise(resolve=>{
        let i=0; const next=()=>{ if(i>=paths.length) return resolve(null);
          const im=new Image(); im.onload=()=>resolve(paths[i]); im.onerror=()=>{ i++; next(); }; im.src=paths[i]; };
        next();
      });
    }
    async function firstExistingFile(paths){
      for(const p of paths){ try{ const r=await fetch(p,{method:'HEAD',cache:'no-cache'}); if(r.ok) return p; }catch(_){} }
      return null;
    }

    /* ---------- links & addresses ---------- */
    async function initLinks(){
      const links = await fetchFirst(['/public/config/links.json','/config/links.json']);
      const set=(id,url)=>{const b=$(id); if(!b) return; if(url){b.href=url; b.removeAttribute('disabled');} else b.setAttribute('disabled','');};
      set('#btn-x',links.x_url); set('#btn-tg',links.tg_url); set('#btn-pcs',links.pancakeswap_url);

      const a = await fetchFirst(['/public/config/addresses.json','/config/addresses.json']);
      const toScan = v => v? `https://bscscan.com/address/${v}` : '#';
      const rows=[['Token',a.token],['Team/Lock',a.team_lock||a.team],['Marketing',a.marketing],['Presale',a.presale],['Burn',a.burn],['User',a.user]];
      $('#addr-table').innerHTML = rows.map(([k,v])=>`<tr><td>${k}</td><td><a href="${toScan(v)}" target="_blank" rel="noopener">${v||''}</a></td></tr>`).join('');
    }

    /* ---------- hero ---------- */
    async function initHero(){
      const src = await firstExistingImage(['/public/hero/main.jpg','/hero/main.jpg','/public/hero/1.jpg','/hero/1.jpg']);
      if(src){ $('#hero-img').src = src; }
    }

    /* ---------- tokenomics ---------- */
    async function initTokenomics(){
      const j = await fetchFirst(['/public/config/allocations.json','/config/allocations.json']);
      const t = j.tokenomics || {lp:54,presale:20,team:15,marketing:10,burn:1};
      const vals=[t.lp,t.presale,t.team,t.marketing,t.burn];
      const names=['LP','Presale','Team','Marketing','Burn'];
      const cols=['#ffd85a','#ff944d','#53d878','#4da1ff','#ff6b6b'];
      const ctx=$('#donut').getContext('2d');
      ctx.clearRect(0,0,300,300);
      let s=-Math.PI/2;
      vals.forEach((v,i)=>{const a=s+2*Math.PI*(v/100);ctx.beginPath();ctx.moveTo(150,150);ctx.arc(150,150,140,s,a);ctx.closePath();ctx.fillStyle=cols[i];ctx.fill();s=a;});
      ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(150,150,82,0,2*Math.PI); ctx.fill(); ctx.globalCompositeOperation='source-over';
      $('#legend').innerHTML = names.map((n,i)=>`<li>â€¢ ${n} ${vals[i]}%</li>`).join(' Â· ');

      const p = j.presale || {}; const soft=p.softcap_bnb ?? j.softcap ?? 'â€”'; const hard=p.hardcap_bnb ?? j.hardcap ?? 'â€”';
      $('#caps').textContent=`Softcap: ${soft} BNB / Hardcap: ${hard} BNB`;

      const getters = ['rate_flex_per_bnb','listing_rate_flex_per_bnb'];
      const rates = { presale: j.rates?.presale, listing: j.rates?.listing };
      if(p[getters[0]]) rates.presale = p[getters[0]];
      if(p[getters[1]]) rates.listing = p[getters[1]];
      const fmt=n=> (Number.isFinite(+n) && +n>0)? (+n).toLocaleString() : 'â€”';
      $('#rates').textContent=`Presale Rate: 1 BNB = ${fmt(rates.presale)} FLEX  â€¢  Listing Rate: 1 BNB = ${fmt(rates.listing)} FLEX`;

      const links = await fetchFirst(['/public/config/links.json','/config/links.json']);
      const btn = $('#btn-pinksale'); if(links.pinksale_url){ btn.textContent='Open Pinksale'; btn.href=links.pinksale_url; btn.removeAttribute('aria-disabled'); }
    }

    /* ---------- countdown ---------- */
    async function initCountdown(){
      let sISO='2025-12-18T21:00:00+09:00', eISO='2026-01-01T21:00:00+09:00';
      const p = await fetchFirst(['/public/config/presale.json','/config/presale.json']);
      if(p.presale_start||p.start){ const x=(p.presale_start||p.start); sISO=x+(String(x).includes('+')?'':'+09:00'); }
      if(p.presale_end||p.end){ const y=(p.presale_end||p.end); eISO=y+(String(y).includes('+')?'':'+09:00'); }
      const s=new Date(sISO), e=new Date(eISO);
      const z=n=>String(n).padStart(2,'0'); const fmt=d=>`${d.getFullYear()}. ${z(d.getMonth()+1)}. ${z(d.getDate())}. ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
      $('#countdown-range').textContent=`${fmt(s)} â†’ ${fmt(e)}`;
      const tick=()=>{const now=new Date();let t=s-now;if(t<0)t=e-now;if(t<=0){$('#countdown').textContent='â€”';return;}
        const d=Math.floor(t/86400000);t%=86400000;const h=Math.floor(t/3600000);t%=3600000;const m=Math.floor(t/60000);t%=60000;const s2=Math.floor(t/1000);
        $('#countdown').textContent=`${d}d ${z(h)}:${z(m)}:${z(s2)}`;};
      tick(); setInterval(tick,1000);
    }

    /* ---------- galleries ---------- */
    async function loadGrid(prefix, target){ const arr=await Promise.all(Array.from({length:8},(_,i)=>i+1).map(n=>firstExistingImage([`/public${prefix}/${n}.jpg`,`${prefix}/${n}.jpg`]))); const ok=arr.filter(Boolean);
      const el=$(target); el.innerHTML = ok.length? ok.map(s=>`<img src="${s}" alt="">`).join('') : '<div class="muted">Images coming soon.</div>'; }

    /* ---------- i18n (ë£¨íŠ¸ ê²½ë¡œê¹Œì§€ íƒìƒ‰ & ì í‘œê¸° ì§€ì›) ---------- */
    async function setLang(lang){
      const dict = await fetchFirst([
        `/public/i18n/${lang}.json`,
        `/i18n/${lang}.json`,
        `/${lang}.json`,          // â† ë£¨íŠ¸ íŒŒì¼ë„ ì§€ì› (ko.json / en.json)
      ]);
      document.querySelectorAll('[data-i18n]').forEach(el=>{
        const key = el.getAttribute('data-i18n');
        const val = deep(dict, key);
        if(val!==undefined) el.textContent = val;
      });
      localStorage.setItem('lang',lang);
      document.querySelectorAll('#lang-pill [data-lang]').forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
    }
    function bindLang(){
      const wanted = new URL(location.href).searchParams.get('lang') || localStorage.getItem('lang') || 'en';
      setLang(wanted);
      document.querySelectorAll('#lang-pill [data-lang]').forEach(btn=> btn.addEventListener('click',()=> setLang(btn.dataset.lang||'en')));
    }

    /* ---------- whitepaper paths & #pdf jump ---------- */
    async function initWhitepapers(){
      const codes=['en','ko','ja','zh','es','de','pt','it'];
      for(const c of codes){
        const a=document.querySelector(`a[href$="/whitepaper/${c}.pdf"],a[href$="/public/whitepaper/${c}.pdf"]`);
        if(!a) continue; const good=await firstExistingFile([`/public/whitepaper/${c}.pdf`,`/whitepaper/${c}.pdf`]);
        if(good){ a.href=good; a.setAttribute('download',''); a.target='_blank'; a.rel='noopener'; }
      }
      const H=()=>{const h=(location.hash||'').toLowerCase(); if(h==='#pdf'||h==='#whitepaper'){document.getElementById('whitepaper')?.scrollIntoView({behavior:'smooth'});}}
      window.addEventListener('hashchange',H); H();
    }

    /* ---------- NFT mint: ì‹œê·¸ë‹ˆì²˜/ê°€ê²© getter ë‹¤ì¤‘ ì‹œë„ ---------- */
    const CHAINS={ bscTestnet:{chainId:'0x61',name:'BSC Testnet',rpc:'https://data-seed-prebsc-1-s3.binance.org:8545'},
                   bscMainnet:{chainId:'0x38',name:'BSC',rpc:'https://bsc-dataseed.binance.org'} };
    const DEFAULT_PRICE_BNB = (window.NFT_PRICE_BNB || '0.0001');
    const ABI_LIST = [
      ["function claim(address receiver,uint256 quantity) payable"],
      ["function claim(uint256 quantity) payable"],
      ["function mint(uint256 quantity) payable"],
      ["function mint() payable"],
      ["function publicMint(uint256 quantity) payable"],
      ["function publicMint() payable"],
      ["function purchase(uint256 quantity) payable"],
      ["function buy(uint256 quantity) payable"]
    ];
    const PRICE_READERS = [
      "function price() view returns (uint256)",
      "function mintPrice() view returns (uint256)",
      "function publicPrice() view returns (uint256)",
      "function cost() view returns (uint256)"
    ];
    let NFT_ADDR={ bscMainnet:'0xYourMainnetNFTAddress', bscTestnet:'0xYourTestnetNFTAddress' };

    async function connect(chainKey){
      const { ethereum } = window; if(!ethereum) throw new Error('ì§€ê°‘ì´ ì—†ìŠµë‹ˆë‹¤. MetaMaskë¥¼ ì„¤ì¹˜í•˜ì„¸ìš”.');
      const target=CHAINS[chainKey];
      try{ await ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:target.chainId}]}); }
      catch(e){ if(e && e.code===4902){
          await ethereum.request({method:'wallet_addEthereumChain',params:[{chainId:target.chainId,chainName:target.name,rpcUrls:[target.rpc],nativeCurrency:{name:'BNB',symbol:'BNB',decimals:18}}]});
        } else throw e; }
      const provider=new ethers.BrowserProvider(ethereum);
      return await provider.getSigner();
    }

    async function readPrice(signer, addr){
      for(const sig of PRICE_READERS){
        try{ const c=new ethers.Contract(addr,[sig],signer); const v=await c[Object.keys(c.interface.fragmentsByName)[0]](); if(v>0n) return v; }catch(_){}
      }
      return ethers.parseEther(DEFAULT_PRICE_BNB); // fallback
    }

    async function setupMintUI(){
      const a=await fetchFirst(['/public/config/addresses.json','/config/addresses.json']);
      if(a.nft_mainnet) NFT_ADDR.bscMainnet=a.nft_mainnet;
      if(a.nft_testnet) NFT_ADDR.bscTestnet=a.nft_testnet;

      const sel=$('#net'), btnC=$('#connect'), btnLegacy=$('#mint'), btnFlex=$('#mint-flex'), log=$('#mint-log');
      const write = s => log.textContent=s;

      btnC.onclick=async()=>{ try{ const s=await connect(sel.value); write('Connected: '+await s.getAddress()); }catch(e){ write('Connect error: '+(e?.message||e)); } };

      async function runMint(forceFixed){
        try{
          const chainKey=sel.value, signer=await connect(chainKey), me=await signer.getAddress();
          const target=NFT_ADDR[chainKey]; if(!target || target.length<20) throw new Error('NFT ì»¨íŠ¸ë™íŠ¸ ì£¼ì†Œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
          const value = forceFixed ? ethers.parseEther(DEFAULT_PRICE_BNB) : await readPrice(signer, target);

          let lastErr=null;
          for(const abi of ABI_LIST){
            try{
              const c=new ethers.Contract(target, abi, signer);
              const fn = Object.keys(c.interface.fragmentsByName)[0];
              let tx;
              if(fn.includes('(address,uint256)'))       tx = await c[fn](me,1,{value});
              else if(fn.includes('(uint256)'))          tx = await c[fn](1,{value});
              else                                       tx = await c[fn]({value});   // mint()
              write('Minting... TX: '+tx.hash);
              await tx.wait();
              write('Minted!');
              return;
            }catch(e){ lastErr = e; }
          }
          throw lastErr || new Error('ë¯¼íŒ… ì‹¤íŒ¨');
        }catch(e){
          // ethersì˜ BUFFER_OVERRUN ê°™ì€ ë‚´ë¶€ ë©”ì‹œì§€ëŠ” ì§§ê²Œ ì •ë¦¬
          const msg = (e&&e.message||String(e)).replace(/buffer.*?OVERRUN.*$/i,'contract call failed');
          write('Mint error: '+msg);
        }
      }

      btnLegacy.onclick = ()=>runMint(false);
      btnFlex.onclick   = ()=>runMint(true);
    }

    /* ---------- boot ---------- */
    (async()=>{
      // i18n ë¨¼ì €
      const want = new URL(location.href).searchParams.get('lang') || localStorage.getItem('lang') || 'en';
      document.querySelectorAll('#lang-pill [data-lang]').forEach(b=> b.classList.toggle('active', b.dataset.lang===want));
      await setLang(want);
      document.querySelectorAll('#lang-pill [data-lang]').forEach(btn=> btn.addEventListener('click',()=> setLang(btn.dataset.lang||'en')));

      await initLinks(); await initHero(); await initTokenomics(); await initCountdown();
      await initWhitepapers(); await loadGrid('/action','#action-grid'); await loadGrid('/nft-preview','#nft-grid');
      await setupMintUI();
    })();
  </script>
</body>
</html>
