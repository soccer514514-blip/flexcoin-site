<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$FLEX is your life — Flexcoin</title>

  <!-- Favicon: /public 우선, 루트 없을 때 404 회피 -->
  <link rel="icon" type="image/svg+xml" href="/public/favicon.svg?v=5">
  <link rel="mask-icon" href="/public/favicon.svg?v=5" color="#f4cc4f">
  <link rel="icon" type="image/x-icon" sizes="any" href="/public/favicon.ico?v=5">
  <link rel="shortcut icon" href="/public/favicon.ico?v=5">

  <!-- Hero preload -->
  <link rel="preload" as="image" href="/public/hero/main.jpg" imagesizes="(max-width:1100px) 100vw, 1100px">

  <!-- Whitepaper discoverability -->
  <link rel="alternate" hreflang="en" href="/public/whitepaper/en.pdf">
  <link rel="alternate" hreflang="ko" href="/public/whitepaper/ko.pdf">
  <link rel="alternate" hreflang="ja" href="/public/whitepaper/ja.pdf">
  <link rel="alternate" hreflang="zh" href="/public/whitepaper/zh.pdf">
  <link rel="alternate" hreflang="es" href="/public/whitepaper/es.pdf">
  <link rel="alternate" hreflang="de" href="/public/whitepaper/de.pdf">
  <link rel="alternate" hreflang="pt" href="/public/whitepaper/pt.pdf">
  <link rel="alternate" hreflang="it" href="/public/whitepaper/it.pdf">

  <style>
    :root{ --bg:#11100d; --card:#1b1915; --text:#eadfbb; --muted:#b9a97a; --gold:#f4cc4f; --chip:#3a331c; --border:rgba(255,255,255,.08) }
    html,body{ margin:0; background:var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Helvetica,Arial; overflow-x:hidden; max-width:100vw }
    body{ padding-top:64px }
    *{ box-sizing:border-box } a{ color:inherit; text-decoration:none } body.noscroll{ overflow:hidden }
    .topbar{ position:fixed; inset:0 auto auto 0; right:0; top:0; display:flex; align-items:center; gap:.5rem; padding:.8rem 1rem; background:linear-gradient(180deg,rgba(0,0,0,.75),rgba(0,0,0,.35)); backdrop-filter:blur(6px); z-index:9999; border-bottom:1px solid var(--border) }
    .brand{ font-weight:800; color:var(--gold); white-space:nowrap } .spacer{ flex:1 }
    .btn{ border:none; border-radius:.7rem; padding:.55rem .9rem; cursor:pointer; background:var(--gold); color:#000; font-weight:800; display:inline-block; white-space:nowrap }
    .btn[disabled]{ opacity:.45; cursor:not-allowed }
    .lang{ display:inline-flex; border-radius:.6rem; overflow:hidden; border:1px solid var(--border) }
    .lang button{ background:var(--chip); padding:.5rem .75rem; border:0; color:var(--text); cursor:pointer }
    .lang button.active{ background:var(--gold); color:#000; font-weight:800 }
    .nav a{ margin-left:.6rem; font-weight:700; color:var(--gold); opacity:.9 } .nav a:hover{ opacity:1 }
    @media(max-width:680px){ .topbar{flex-wrap:wrap;gap:.4rem} .brand{flex:1 1 100%;font-size:1rem} .nav{order:3;width:100%;display:flex;gap:.8rem .6rem;flex-wrap:wrap} .btn{padding:.5rem .7rem} .lang{order:4}}
    .wrap{ max-width:1100px; margin:0 auto; padding:1rem }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:18px; padding:16px; margin-top:1rem }
    .section-title{ font-size:1.4rem; font-weight:900; margin:.4rem 0 1rem; color:var(--gold) }
    .muted{ color:var(--muted); font-size:.95rem }
    .hero{ background:#0f0e0c; border-radius:18px; overflow:hidden; border:1px solid var(--border) }
    .hero img{ display:block; width:100%; height:auto }
    .tok-wrap{ display:grid; grid-template-columns:320px 1fr; gap:18px } canvas{ background:#0f0e0c; border-radius:14px }
    ul.legend{ list-style:none; padding:0; margin:0 } ul.legend li{ margin:.2rem 0 } #caps,#rates{ margin-top:.35rem } #btn-pinksale{ margin-top:12px; display:inline-block }
    .countbox{ border:1px solid var(--border); border-radius:14px; padding:14px; background:linear-gradient(180deg,rgba(255,255,255,.02),transparent) } #countdown{ font-weight:900; font-size:1.35rem }
    .wp-grid{ display:flex; flex-wrap:wrap; gap:.5rem } .wp-note{ margin-top:.5rem }
    .addr table{ width:100%; border-collapse:collapse; font-size:.92rem } .addr td{ padding:.45rem .55rem; border-bottom:1px dashed var(--border); word-break:break-all } .addr a{ color:var(--gold) }
    .grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px } .grid img{ width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:12px; border:1px solid var(--border); background:#0f0e0c }
    @media(max-width:900px){ .tok-wrap{grid-template-columns:1fr} .grid{grid-template-columns:repeat(2,1fr)} .addr td{font-size:.85rem} }
    .btn-row{ display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center; margin-top:.6rem }
    .btn-gold{ background:var(--gold); color:#000; border-radius:.7rem; padding:.55rem .9rem; font-weight:800; border:0; cursor:pointer }
    .select-net{ margin:8px 0; padding:.45rem .6rem; border-radius:.6rem; border:1px solid var(--border); background:#0f0e0c; color:var(--text) }
    .mint-log{ background:#0f0e0c; border:1px solid var(--border); border-radius:12px; padding:10px; margin-top:10px; color:#ddd; font-size:.85rem; min-height:2.2em; white-space:pre-wrap }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/ethers@6.12.1/dist/ethers.umd.min.js" defer></script>
</head>
<body>
  <div class="topbar">
    <div class="brand" id="brand">$FLEX is your life. Your life is FLEX.</div>
    <div class="spacer"></div>
    <div class="nav">
      <a href="#about-flexcoin">About</a><a href="#whitepaper">Whitepaper</a><a href="#roadmap">Roadmap</a><a href="#nft">NFT</a>
    </div>
    <a id="btn-x" class="btn" href="#" target="_blank" rel="noopener">X</a>
    <a id="btn-tg" class="btn" href="#" target="_blank" rel="noopener">Telegram</a>
    <a id="btn-pcs" class="btn" href="#" target="_blank" rel="noopener">Buy on PancakeSwap</a>
    <div class="lang" id="lang-pill"><button data-lang="en" class="active">EN</button><button data-lang="ko">KR</button></div>
  </div>

  <div class="wrap">
    <section class="card hero">
      <img id="hero-img" src="/public/hero/main.jpg" alt="Flexcoin hero"
           loading="eager" decoding="async"
           sizes="(max-width:1100px) 100vw, 1100px"
           onerror="this.onerror=null;this.src='/public/hero/1.jpg'">
    </section>

    <section id="about-flexcoin" class="card">
      <div class="section-title">About FlexCoin</div>
      <div class="muted">Flex = 능력/소비력/자신감 · Transparency → Trust</div>
    </section>

    <section class="card">
      <div class="section-title">Tokenomics</div>
      <div class="tok-wrap">
        <canvas id="donut" width="300" height="300"></canvas>
        <div>
          <ul class="legend" id="legend"></ul>
          <div id="caps" class="muted"></div>
          <div id="rates" class="muted"></div>
          <a id="btn-pinksale" class="btn" aria-disabled="true">Pinksale (coming soon)</a>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="section-title">Presale Countdown</div>
      <div class="countbox"><div id="countdown">—</div><div id="countdown-range" class="muted">—</div></div>
    </section>

    <section class="card"><div class="section-title">Action Preview</div><div class="grid" id="action-grid"></div></section>
    <section class="card"><div class="section-title">NFT Preview</div><div class="grid" id="nft-grid"></div></section>

    <section id="whitepaper" class="card">
      <div class="section-title">Whitepaper</div>
      <div class="wp-grid">
        <a class="btn" href="/public/whitepaper/en.pdf" download>English</a>
        <a class="btn" href="/public/whitepaper/ko.pdf" download>Korean</a>
        <a class="btn" href="/public/whitepaper/ja.pdf" download>Japanese</a>
        <a class="btn" href="/public/whitepaper/zh.pdf" download>Chinese</a>
        <a class="btn" href="/public/whitepaper/es.pdf" download>Spanish</a>
        <a class="btn" href="/public/whitepaper/de.pdf" download>German</a>
        <a class="btn" href="/public/whitepaper/pt.pdf" download>Portuguese</a>
        <a class="btn" href="/public/whitepaper/it.pdf" download>Italian</a>
      </div>
    </section>

    <section class="card addr">
      <div class="section-title">Addresses</div>
      <table id="addr-table"></table>
    </section>

    <section id="roadmap" class="card">
      <div class="section-title">Roadmap</div>
      <div class="grid">
        <img src="/public/hero/1.jpg" alt="" loading="lazy">
        <img src="/public/hero/2.jpg" alt="" loading="lazy">
        <img src="/public/hero/3.jpg" alt="" loading="lazy">
        <img src="/public/hero/4.jpg" alt="" loading="lazy">
      </div>
    </section>

    <section id="nft" class="card">
      <div class="section-title">FLEX NFT MINT</div>
      <p class="muted">Mint your official <b>FlexNFT</b> on BNB Smart Chain</p>
      <div style="text-align:center;">
        <select id="net" class="select-net">
          <option value="bscMainnet">BNB Mainnet</option>
          <option value="bscTestnet">BNB Testnet</option>
        </select>
        <div class="btn-row">
          <button id="connect" class="btn-gold">Connect Wallet</button>
          <button id="mint" class="btn-gold">Mint NFT (Legacy)</button>
          <button id="mint-flex" class="btn-gold">Mint FlexNFT (0.0001 BNB)</button>
        </div>
        <pre id="mint-log" class="mint-log">[ Waiting for connection... ]</pre>
      </div>
    </section>
  </div>

  <script>
    const $ = q => document.querySelector(q);

    // -------- small helpers --------
    async function fetchJSONSafe(url){
      try{
        const r = await fetch(url, {cache:'no-cache'});
        if(!r.ok) return null;
        return await r.json().catch(()=>null);
      }catch{ return null; }
    }
    async function firstJSON(paths){
      for(const p of paths){
        const j = await fetchJSONSafe(p);
        if(j) return j;
      }
      return {};
    }

    // -------- links / addresses --------
    async function initLinks(){
      const links = await firstJSON(['/public/config/links.json','/config/links.json']);
      const set=(id,url)=>{const el=$(id); if(!el) return; if(url){el.href=url}else{el.setAttribute('disabled','')}};
      set('#btn-x',links.x_url); set('#btn-tg',links.tg_url); set('#btn-pcs',links.pancakeswap_url);

      const addr = await firstJSON(['/public/config/addresses.json','/config/addresses.json']);
      const toScan=a=>a?`https://bscscan.com/address/${a}`:'#';
      const rows=[['Token',addr.token],['Team/Lock',addr.team_lock||addr.team],['Marketing',addr.marketing],
                  ['Presale',addr.presale],['Burn',addr.burn],['User',addr.user]];
      $('#addr-table').innerHTML = rows.map(([k,v])=>`<tr><td>${k}</td><td><a href="${toScan(v)}" target="_blank" rel="noopener">${v||''}</a></td></tr>`).join('');
      return addr;
    }

    // -------- hero --------
    (function(){ const img=$('#hero-img'); const test=['/public/hero/main.avif','/public/hero/main.webp','/public/hero/main.jpg','/public/hero/1.jpg']; (async()=>{for(const p of test){ try{const r=await fetch(p,{method:'HEAD'}); if(r.ok){img.src=p; break}}catch{}})() })();

    // -------- tokenomics / countdown --------
    async function initTokenomics(){
      const j = await firstJSON(['/public/config/allocations.json','/config/allocations.json']);
      const t = j.tokenomics || {lp:54,presale:20,team:15,marketing:10,burn:1};
      const ctx=$('#donut').getContext('2d'), vals=[t.lp,t.presale,t.team,t.marketing,t.burn], names=['LP','Presale','Team','Marketing','Burn'], cols=['#ffd85a','#ff944d','#53d878','#4da1ff','#ff6b6b'];
      ctx.clearRect(0,0,300,300); let s=-Math.PI/2; vals.forEach((v,i)=>{const a=s+2*Math.PI*(v/100); ctx.beginPath(); ctx.moveTo(150,150); ctx.arc(150,150,140,s,a); ctx.closePath(); ctx.fillStyle=cols[i]; ctx.fill(); s=a}); ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(150,150,82,0,2*Math.PI); ctx.fill(); ctx.globalCompositeOperation='source-over';
      $('#legend').innerHTML = names.map((n,i)=>`<li>• ${n} ${vals[i]}%</li>`).join(' · ');
      const p = j.presale || {}; const soft = p.softcap_bnb ?? j.softcap ?? '—', hard = p.hardcap_bnb ?? j.hardcap ?? '—';
      $('#caps').textContent=`Softcap: ${soft} BNB / Hardcap: ${hard} BNB`;
      const pres=Number(p.rate_flex_per_bnb ?? (j.rates?.presale||0)), list=Number(p.listing_rate_flex_per_bnb ?? (j.rates?.listing||0));
      const fmt=n=>(Number.isFinite(n)&&n>0)?n.toLocaleString():'—';
      $('#rates').textContent=`Presale Rate: 1 BNB = ${fmt(pres)} FLEX  •  Listing Rate: 1 BNB = ${fmt(list)} FLEX`;
      const links = await firstJSON(['/public/config/links.json','/config/links.json']); const btn=$('#btn-pinksale'); if(links?.pinksale_url){ btn.textContent='Open Pinksale'; btn.href=links.pinksale_url; btn.removeAttribute('aria-disabled'); }
    }
    async function initCountdown(){
      let sISO='2025-12-18T21:00:00+09:00', eISO='2026-01-01T21:00:00+09:00';
      const p = await firstJSON(['/public/config/presale.json','/config/presale.json']);
      if(p.presale_start||p.start) sISO=(p.presale_start||p.start).replace(' ', 'T')+(String(p.presale_start||p.start).includes('+')?'':'+09:00');
      if(p.presale_end||p.end)   eISO=(p.presale_end||p.end).replace(' ', 'T')+(String(p.presale_end||p.end).includes('+')?'':'+09:00');
      const s=new Date(sISO), e=new Date(eISO), z=n=>String(n).padStart(2,'0'), fmt=d=>`${d.getFullYear()}. ${z(d.getMonth()+1)}. ${z(d.getDate())}. ${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
      $('#countdown-range').textContent=`${fmt(s)} → ${fmt(e)}`;
      const tick=()=>{ const now=new Date(); let t=s-now; if(t<0) t=e-now; if(t<=0) return $('#countdown').textContent='—'; const d=Math.floor(t/86400000); t%=86400000; const h=Math.floor(t/3600000); t%=3600000; const m=Math.floor(t/60000); t%=60000; const s2=Math.floor(t/1000); $('#countdown').textContent=`${d}d ${z(h)}:${z(m)}:${z(s2)}` };
      tick(); setInterval(tick,1000);
    }

    // -------- preview grids --------
    function gridHTML(base){ return Array.from({length:8},(_,i)=>i+1).map(n=>`<picture><source type="image/avif" srcset="/public/${base}/${n}.avif"><source type="image/webp" srcset="/public/${base}/${n}.webp"><img src="/public/${base}/${n}.jpg" loading="lazy" decoding="async" alt=""></picture>`).join('') }
    $('#action-grid').innerHTML = gridHTML('action'); $('#nft-grid').innerHTML = gridHTML('nft-preview');

    // -------- mint (resilient) --------
    const CHAINS={ bscTestnet:{chainId:'0x61',name:'BSC Testnet',rpc:'https://data-seed-prebsc-1-s3.binance.org:8545'}, bscMainnet:{chainId:'0x38',name:'BSC',rpc:'https://bsc-dataseed.binance.org'} };
    const ABI_VARIANTS = [
      ["function claim(address receiver, uint256 quantity) payable","function price() view returns (uint256)"],
      ["function claim(uint256 quantity) payable","function price() view returns (uint256)"],
      ["function mint(uint256 quantity) payable","function price() view returns (uint256)"]
    ];
    const DEFAULT_PRICE_BNB = '0.0001';
    let NFT_ADDR={ bscMainnet:'', bscTestnet:'' };

    function logMint(m){ const el=$('#mint-log'); el.textContent = (el.textContent.trim()? el.textContent+"\n":"")+m }
    async function connect(chainKey){
      const { ethereum } = window; if(!ethereum) throw new Error('Install MetaMask.');
      const t=CHAINS[chainKey];
      try{ await ethereum.request({method:'wallet_switchEthereumChain',params:[{chainId:t.chainId}]}); }
      catch(e){ if(e?.code===4902){ await ethereum.request({method:'wallet_addEthereumChain',params:[{chainId:t.chainId,chainName:t.name,rpcUrls:[t.rpc],nativeCurrency:{name:'BNB',symbol:'BNB',decimals:18}}]}); } else { throw e; } }
      const provider=new ethers.BrowserProvider(ethereum); return await provider.getSigner();
    }
    async function safePrice(c){ try{ return await c.price(); }catch{ return ethers.parseEther(DEFAULT_PRICE_BNB); } }
    async function runMintInternal(signer, c, to, forceFixed){
      const value = forceFixed ? ethers.parseEther(DEFAULT_PRICE_BNB) : await safePrice(c);
      let tx; try{
        const est = c.claim ? (await (async()=>{ try{return await c.estimateGas.claim(to,1,{value})}catch{return await c.estimateGas.claim(1,{value})} })()) : await c.estimateGas.mint(1,{value});
        const gasLimit = est ? (est*12n/10n) : undefined;
        if(c.claim){ try{ tx=await c.claim(to,1,{value,gasLimit,type:0}); } catch{ tx=await c.claim(1,{value,gasLimit}); } }
        else { tx=await c.mint(1,{value,gasLimit,type:0}); }
      }catch{ if(c.claim){ try{ tx=await c.claim(to,1,{value}); } catch{ tx=await c.claim(1,{value}); } } else { tx=await c.mint(1,{value}); } }
      logMint('Minting... TX: '+tx.hash); await tx.wait(); logMint('✅ Minted!');
    }

    async function setupMintUI(){
      const addr = await initLinks(); // links + table 렌더 + 주소 확보
      NFT_ADDR.bscMainnet = addr.nft_mainnet || '';
      NFT_ADDR.bscTestnet = addr.nft_testnet || '';

      await initTokenomics();
      await initCountdown();

      const sel=$('#net'), btnC=$('#connect'), btnLegacy=$('#mint'), btnFlex=$('#mint-flex');
      btnC.onclick=async()=>{ try{ const s=await connect(sel.value); $('#mint-log').textContent='Connected: '+await s.getAddress(); }catch(e){ $('#mint-log').textContent='Connect error: '+(e.message||e) } };

      async function runMint(forceFixed){
        try{
          const chainKey=sel.value, signer=await connect(chainKey), to=await signer.getAddress();
          const target=NFT_ADDR[chainKey]; if(!target) throw new Error('NFT contract address not set.');
          for(const abi of ABI_VARIANTS){
            try{ const c=new ethers.Contract(target, abi, signer); await runMintInternal(signer, c, to, forceFixed); return; }catch{}
          }
          throw new Error('Mint failed with all ABI variants.');
        }catch(e){ $('#mint-log').textContent='Mint error: '+(e.message||e); }
      }
      btnLegacy.onclick = ()=>runMint(false);
      btnFlex.onclick   = ()=>runMint(true);
    }

    // boot
    (async()=>{ await setupMintUI(); })();
  </script>
</body>
</html>
