<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$FLEX is your life — Flexcoin</title>
  <link rel="icon" href="./public/favicon.ico">
  <style>
    :root{
      --bg:#11100d; --card:#1b1915; --text:#eadfbb; --muted:#b9a97a;
      --accent:#8b7e45; --gold:#f4cc4f; --chip:#3a331c;
    }
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Helvetica,Arial}
    a{color:inherit}
    .topbar{display:flex;align-items:center;gap:.5rem;padding:.8rem 1rem;
      background:linear-gradient(180deg,rgba(0,0,0,.45),transparent);
      backdrop-filter:blur(6px);position:sticky;top:0;z-index:10;}
    .brand{font-weight:700;color:var(--gold);}
    .spacer{flex:1}
    .btn{border:none;border-radius:.7rem;padding:.45rem .8rem;cursor:pointer;
      text-decoration:none;background:var(--gold);color:#000;font-weight:700;}
    .btn:disabled{opacity:.4;cursor:not-allowed}
    .lang{display:inline-flex;border-radius:.6rem;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
    .lang button{background:var(--chip);padding:.45rem .7rem;border:0;color:var(--text);cursor:pointer}
    .lang button.active{background:var(--gold);color:#000;font-weight:700}
    .wrap{max-width:1080px;margin:0 auto;padding:1rem}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);
      border-radius:16px;padding:14px;margin-top:1rem}
    .section-title{font-size:1.4rem;font-weight:800;margin:.4rem 0 1rem;color:var(--gold)}
    .muted{color:var(--muted);font-size:.9rem}
    canvas{background:#0f0e0c;border-radius:14px}
    .addr table{width:100%;border-collapse:collapse;font-size:.85rem}
    .addr td{padding:.35rem .5rem;border-bottom:1px dashed rgba(255,255,255,.06);word-break:break-all}
    .addr a{color:var(--gold);text-decoration:none}
    @media(max-width:820px){.addr td{font-size:.75rem}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">$FLEX is your life. Your life is FLEX.</div>
    <div class="spacer"></div>
    <a id="btn-x" class="btn" href="#" target="_blank" rel="noopener">X</a>
    <a id="btn-tg" class="btn" href="#" target="_blank" rel="noopener">Telegram</a>
    <a id="btn-pcs" class="btn" href="#" target="_blank" rel="noopener">Buy on PancakeSwap</a>
    <div class="lang"><button id="lang-en">EN</button><button id="lang-ko">KR</button></div>
  </div>

  <div class="wrap">
    <!-- Tokenomics -->
    <section class="card">
      <div class="section-title">Tokenomics</div>
      <canvas id="donut" width="300" height="300"></canvas>
      <ul id="legend"></ul>
      <div id="caps" class="muted"></div>
      <div id="rates" class="muted"></div>
      <button id="btn-pinksale" class="btn" disabled>Pinksale (coming soon)</button>
    </section>

    <!-- Countdown -->
    <section class="card">
      <div class="section-title">Presale Countdown</div>
      <div id="countdown" style="font-weight:800;font-size:1.2rem">—</div>
      <div id="countdown-range" class="muted">—</div>
    </section>

    <!-- Whitepaper -->
    <section class="card">
      <div class="section-title">Whitepaper</div>
      <div>
        <a class="btn" href="./whitepaper/whitepaper-en.pdf" download>EN</a>
        <a class="btn" href="./whitepaper/whitepaper-ko.pdf" download>KO</a>
        <a class="btn" href="./whitepaper/whitepaper-ja.pdf" download>JA</a>
        <a class="btn" href="./whitepaper/whitepaper-zh.pdf" download>ZH</a>
      </div>
      <div class="muted">※ 다운로드가 막히면 새 탭에서 열림 → “다른 이름으로 저장”.</div>
    </section>

    <!-- Addresses -->
    <section class="card addr">
      <div class="section-title">Addresses</div>
      <table id="addr-table"></table>
    </section>
  </div>

  <script>
    const $ = (q)=>document.querySelector(q);
    const fetchJSON = async (p)=> (await fetch(p,{cache:'no-cache'})).json();

    /* Links + BscScan */
    async function initLinks(){
      const links=await fetchJSON('./public/config/links.json');
      const set=(sel,url)=>{const b=$(sel); if(url){b.href=url;b.disabled=false}else{b.disabled=true}};
      set('#btn-x',links.x_url);
      set('#btn-tg',links.tg_url);
      set('#btn-pcs',links.pancakeswap_url);
      const psBtn=$('#btn-pinksale');
      if(links.pinksale_url){ psBtn.disabled=false; psBtn.onclick=()=>window.open(links.pinksale_url,'_blank','noopener'); }

      const addr=await fetchJSON('./public/config/addresses.json');
      const toScan=(a)=>a?`https://bscscan.com/address/${a}`:'';
      const rows=[['Token',addr.token],['Team/Lock',addr.team_lock],['Marketing',addr.marketing],
                  ['Presale',addr.presale],['Burn',addr.burn],['User',addr.user]];
      $('#addr-table').innerHTML = rows
        .map(([k,v])=>`<tr><td>${k}</td><td><a href="${toScan(v)}" target="_blank" rel="noopener">${v||'—'}</a></td></tr>`).join('');
    }

    /* Donut + Caps + Rate (allocations.json: tokenomics + presale) */
    async function initTokenomics(){
      const j=await fetchJSON('./public/config/allocations.json');
      const t=j.tokenomics||j;
      const p=j.presale||{};
      const vals=[t.lp,t.presale,t.team,t.marketing,t.burn].map(Number);
      const ctx=$('#donut').getContext('2d');
      const cols=['#ffd85a','#ff944d','#53d878','#4da1ff','#ff6b6b'];
      let start=-Math.PI/2;
      vals.forEach((v,i)=>{
        const end=start+2*Math.PI*(v/100);
        ctx.beginPath();ctx.moveTo(150,150);ctx.arc(150,150,140,start,end);ctx.closePath();
        ctx.fillStyle=cols[i];ctx.fill();start=end;
      });
      ctx.globalCompositeOperation='destination-out';ctx.beginPath();ctx.arc(150,150,80,0,2*Math.PI);ctx.fill();
      ctx.globalCompositeOperation='source-over';

      $('#legend').innerHTML=`<li>LP ${t.lp}% • Presale ${t.presale}% • Team ${t.team}% • Marketing ${t.marketing}% • Burn ${t.burn}%</li>`;
      $('#caps').textContent=`Softcap: ${p.softcap_bnb??'—'} BNB / Hardcap: ${p.hardcap_bnb??'—'} BNB`;
      const rate=(n)=> (Number(n)||0).toLocaleString();
      $('#rates').textContent=`Presale Rate: 1 BNB = ${rate(p.rate_flex_per_bnb)} FLEX • Listing Rate: 1 BNB = ${rate(p.listing_rate_flex_per_bnb)} FLEX`;
    }

    /* Countdown (presale.json: timezone + presale_start/end) */
    async function initCountdown(){
      const p=await fetchJSON('./public/config/presale.json');
      const tz = p.timezone || 'Asia/Seoul';
      // 문자열 그대로 Date로 만들기 + 타임존 보정(간단히 +09:00 기본)
      const z = (tz.includes('Seoul')||tz.includes('Tokyo'))?'+09:00':'';
      const s=new Date((p.presale_start||p.start_iso)+z);
      const e=new Date((p.presale_end||p.end_iso)+z);
      const range=$('#countdown-range'),count=$('#countdown');
      range.textContent=`${s.toLocaleString()} → ${e.toLocaleString()}`;
      const pad=(n)=>String(n).padStart(2,'0');
      setInterval(()=>{
        const now=new Date();
        let t = (now < s) ? (s-now) : (e-now);
        if(t<=0){ count.textContent='—'; return; }
        const d=Math.floor(t/86400000); t%=86400000;
        const h=Math.floor(t/3600000);  t%=3600000;
        const m=Math.floor(t/60000);    t%=60000;
        const s2=Math.floor(t/1000);
        count.textContent = `${d}d ${pad(h)}:${pad(m)}:${pad(s2)}`;
      },1000);
    }

    (async()=>{ await initLinks(); await initTokenomics(); await initCountdown(); })();
  </script>
</body>
</html>
