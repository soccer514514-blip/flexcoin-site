<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <title>Flexcoin — $FLEX</title>
    <meta name="theme-color" content="#000000" />
  </head>
  <body>
    <div id="app"></div>

    <!-- ================================
         ✅ Flexcoin Multi-Path Loader (Vite 2025)
         - manifest 기반 우선, 실패 시 정적 경로 다중 시도
         - GitHub Pages / 커스텀 도메인/서브패스 안전
       ================================= -->
    <script>
      (async () => {
        const el = (t, a) => Object.assign(document.createElement(t), a || {});

        const add = (tag, attrs, parent = document.head) => {
          const node = el(tag, attrs);
          parent.appendChild(node);
          return new Promise((res, rej) => {
            node.onload = () => res(true);
            node.onerror = () => rej(new Error(attrs.src || attrs.href || tag));
          });
        };

        const tryLoad = async (candidates) => {
          for (const c of candidates) {
            try {
              if (c.endsWith(".css")) {
                await add("link", { rel: "stylesheet", href: c });
              } else {
                await add("script", { type: "module", src: c }, document.body);
              }
              return c;
            } catch (e) {}
          }
          throw new Error("all candidates failed");
        };

        // 1) manifest 우선
        const mPaths = [];
        try {
          const res = await fetch("./.vite/manifest.json", { cache: "no-store" });
          if (res.ok) {
            const m = await res.json();
            const entry = m["index.html"] || Object.values(m)[0] || {};
            if (entry.css) entry.css.forEach((css) => mPaths.push(`./${css}`));
            if (entry.file) mPaths.push(`./${entry.file}`);
          }
        } catch (e) {}

        // 2) 정적 후보 경로 (루트/서브패스/리포명 대응)
        const repo = location.pathname.split("/").filter(Boolean)[0] || "";
        const bases = [
          "./assets/",
          "/assets/",
          `/${repo}/assets/`,
          (window.__FLEX_BASE__ || "").replace(/\/?$/, "/assets/")
        ].filter(Boolean);

        const jsBases = bases.map((b) => b);
        const cssBases = bases.map((b) => b);

        const fallbacks = [
          ...cssBases.map((b) => b + "index.css"),
          ...jsBases.map((b) => b + "index.js"),
          ...jsBases.map((b) => b + "main.js")
        ];

        try {
          // CSS 먼저
          const cssList = mPaths.filter((p) => p.endsWith(".css"));
          if (cssList.length) await tryLoad(cssList);
          else await tryLoad(fallbacks.filter((x) => x.endsWith(".css")));

          // JS 다음
          const jsList = mPaths.filter((p) => p.endsWith(".js"));
          await tryLoad(jsList.length ? jsList : fallbacks.filter((x) => x.endsWith(".js")));
        } catch (e) {
          document.body.style.cssText =
            "margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#000;color:#ffd700;font-family:system-ui, Pretendard, sans-serif;text-align:center;padding:24px;";
          document.body.innerHTML =
            "<div><div style='font-size:56px'>⚠️</div><h1 style='margin:8px 0'>로드 실패</h1><p>배포 산출물(./dist)이 비어있거나 경로가 올바르지 않습니다.<br/>Actions 빌드가 성공했고 <code>dist/</code>가 업로드되었는지 확인하세요.</p></div>";
          console.error("[Flex Loader] failed:", e);
        }
      })();
    </script>
  </body>
</html>
