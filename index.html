<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>$FLEX is your life — Flexcoin</title>
  <link rel="icon" href="/public/favicon.ico">
  <style>
    :root{
      --bg:#11100d; --card:#1b1915; --text:#eadfbb; --muted:#b9a97a;
      --gold:#f4cc4f; --chip:#3a331c;
    }
    html,body{margin:0;background:var(--bg);color:var(--text);
      font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Helvetica,Arial}
    a{color:inherit}

    /* Top */
    .topbar{display:flex;align-items:center;gap:.5rem;padding:.8rem 1rem;
      background:linear-gradient(180deg,rgba(0,0,0,.45),transparent);
      position:sticky;top:0;z-index:10}
    .brand{font-weight:800;color:var(--gold);line-height:1.1}
    .spacer{flex:1}
    .btn{border:none;border-radius:.7rem;padding:.52rem .88rem;cursor:pointer;
      text-decoration:none;background:var(--gold);color:#000;font-weight:800}
    .btn:disabled{opacity:.45;cursor:not-allowed}

    /* Layout */
    .wrap{max-width:1080px;margin:0 auto;padding:1rem}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);
      border-radius:16px;padding:14px;margin-top:1rem}
    .section-title{font-size:1.4rem;font-weight:900;margin:.4rem 0 1rem;color:var(--gold)}
    .muted{color:var(--muted);font-size:.9rem}

    /* Hero (있으면 보이고, 없어도 안전) */
    .hero{display:block;border-radius:14px;overflow:hidden}
    .hero img{width:100%;height:auto;display:block}

    /* Tokenomics */
    #donut{background:#0f0e0c;border-radius:14px;display:block;margin-bottom:.6rem}
    #legend{list-style:none;padding:0;margin:.3rem 0 .2rem 0;font-weight:700}
    #legend li{margin:.2rem 0}
    #caps,#rates{margin:.2rem 0}
    #btn-pinksale{margin-top:12px;display:inline-block} /* ← 겹침 해결 */

    /* Addresses */
    .addr table{width:100%;border-collapse:collapse;font-size:.9rem}
    .addr td{padding:.45rem .55rem;border-bottom:1px dashed rgba(255,255,255,.08);word-break:break-all}
    .addr a{color:var(--gold);text-decoration:none}

    /* Whitepaper buttons: 겹침 없이 래핑 */
    .wp-row{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.5rem}
    .wp-row .btn{background:var(--chip);color:var(--gold);border:1px solid rgba(255,255,255,.08)}
    .wp-note{margin-top:.25rem}

    @media(max-width:820px){
      .addr td{font-size:.8rem}
      .brand{max-width:45vw}
    }
  </style>
</head>
<body>
  <!-- Top -->
  <div class="topbar">
    <div class="brand">$FLEX is your life. Your life is FLEX.</div>
    <div class="spacer"></div>
    <a id="btn-x"   class="btn" href="#" target="_blank" rel="noopener">X</a>
    <a id="btn-tg"  class="btn" href="#" target="_blank" rel="noopener">Telegram</a>
    <a id="btn-pcs" class="btn" href="#" target="_blank" rel="noopener">Buy on PancakeSwap</a>
  </div>

  <div class="wrap">
    <!-- Hero: /public/hero/main.jpg 가 있으면 표시됨 -->
    <section class="card hero">
      <img src="/public/hero/main.jpg" alt="Flexcoin hero" onerror="this.parentElement.style.display='none'">
    </section>

    <!-- Tokenomics -->
    <section class="card">
      <div class="section-title">Tokenomics</div>
      <canvas id="donut" width="300" height="300"></canvas>
      <ul id="legend"></ul>
      <div id="caps"  class="muted"></div>
      <div id="rates" class="muted"></div>
      <button id="btn-pinksale" class="btn" disabled>Pinksale (coming soon)</button>
    </section>

    <!-- Countdown -->
    <section class="card">
      <div class="section-title">Presale Countdown</div>
      <div id="countdown" style="font-weight:900;font-size:1.2rem">—</div>
      <div id="countdown-range" class="muted">—</div>
    </section>

    <!-- Whitepaper (경로/겹침 고정) -->
    <section class="card">
      <div class="section-title">Whitepaper</div>
      <div class="wp-row">
        <a class="btn" href="/public/whitepaper/en.pdf" download target="_blank" rel="noopener">EN</a>
        <a class="btn" href="/public/whitepaper/ko.pdf" download target="_blank" rel="noopener">KO</a>
        <a class="btn" href="/public/whitepaper/ja.pdf" download target="_blank" rel="noopener">JA</a>
        <a class="btn" href="/public/whitepaper/zh.pdf" download target="_blank" rel="noopener">ZH</a>
        <a class="btn" href="/public/whitepaper/es.pdf" download target="_blank" rel="noopener">ES</a>
        <a class="btn" href="/public/whitepaper/de.pdf" download target="_blank" rel="noopener">DE</a>
        <a class="btn" href="/public/whitepaper/pt.pdf" download target="_blank" rel="noopener">PT</a>
        <a class="btn" href="/public/whitepaper/it.pdf" download target="_blank" rel="noopener">IT</a>
      </div>
      <div class="muted wp-note">※ 다운로드가 막히면 새 탭에서 열림 → “다른 이름으로 저장”.</div>
    </section>

    <!-- Addresses -->
    <section class="card addr">
      <div class="section-title">Addresses</div>
      <table id="addr-table"></table>
    </section>
  </div>

  <script>
    const $ = (q)=>document.querySelector(q);
    const fetchJSON = async (p)=>{
      const r = await fetch(p,{cache:'no-cache'});
      if(!r.ok) throw new Error(p+' '+r.status);
      return r.json();
    };

    /* 1) Links + BscScan + Buttons */
    async function initLinks(){
      try{
        const links=await fetchJSON('/public/config/links.json');
        const set=(id,url)=>{const b=$(id); if(b){ if(url){b.href=url; b.disabled=false;} else {b.disabled=true;} }};
        set('#btn-x',links.x_url);
        set('#btn-tg',links.tg_url);
        set('#btn-pcs',links.pancakeswap_url);
      }catch(e){ /* noop */ }

      try{
        const addr=await fetchJSON('/public/config/addresses.json');
        const toScan=(a)=>a?`https://bscscan.com/address/${a}`:'';
        const rows=[
          ['Token',addr.token],
          ['Team/Lock',addr.team_lock],
          ['Marketing',addr.marketing],
          ['Presale',addr.presale],
          ['Burn',addr.burn],
          ['User',addr.user]
        ];
        $('#addr-table').innerHTML = rows.map(([k,v]) =>
          `<tr><td style="width:120px;font-weight:800">${k}</td><td><a href="${toScan(v)}" target="_blank" rel="noopener">${v||''}</a></td></tr>`
        ).join('');
      }catch(e){ /* noop */ }
    }

    /* 2) Tokenomics + Caps + Rates + Pinksale link enable if set */
    async function initTokenomics(){
      try{
        const j=await fetchJSON('/public/config/allocations.json');
        const t=j.tokenomics||j;
        const ctx=$('#donut').getContext('2d');
        const vals=[t.lp,t.presale,t.team,t.marketing,t.burn];
        const cols=['#ffd85a','#ff944d','#53d878','#4da1ff','#ff6b6b'];
        let start=-Math.PI/2;
        vals.forEach((v,i)=>{
          const a=start+2*Math.PI*(v/100);
          ctx.beginPath();ctx.moveTo(150,150);
          ctx.arc(150,150,140,start,a);ctx.closePath();
          ctx.fillStyle=cols[i];ctx.fill();start=a;
        });
        ctx.globalCompositeOperation='destination-out';
        ctx.beginPath();ctx.arc(150,150,80,0,2*Math.PI);ctx.fill();
        ctx.globalCompositeOperation='source-over';

        $('#legend').innerHTML =
          `<li>• LP ${t.lp}% • Presale ${t.presale}% • Team ${t.team}% • Marketing ${t.marketing}% • Burn ${t.burn}%</li>`;

        const p=j.presale||{};
        const soft = (p.softcap_bnb ?? '—') + (p.softcap_bnb?' BNB':'');
        const hard = (p.hardcap_bnb ?? '—') + (p.hardcap_bnb?' BNB':'');
        $('#caps').textContent = `Softcap: ${soft} / Hardcap: ${hard}`;

        const rate    = (p.rate_flex_per_bnb ?? 0).toLocaleString();
        const listing = (p.listing_rate_flex_per_bnb ?? 0).toLocaleString();
        if(p.rate_flex_per_bnb){
          $('#rates').textContent = `Presale Rate: 1 BNB = ${rate} FLEX  •  Listing Rate: 1 BNB = ${listing} FLEX`;
        }else{
          $('#rates').textContent = '';
        }

        // Pinksale URL 있으면 버튼 활성화
        const links=await fetchJSON('/public/config/links.json').catch(()=>({}));
        const ps = links.pinksale_url || j.pinksale_url || '';
        const pb = $('#btn-pinksale');
        if(ps){ pb.disabled=false; pb.textContent='Pinksale'; pb.onclick=()=>window.open(ps,'_blank','noopener'); }
      }catch(e){ /* noop */ }
    }

    /* 3) Countdown (KST, ISO 모두 지원) */
    async function initCountdown(){
      try{
        const p=await fetchJSON('/public/config/presale.json');
        // presale.json 포맷: { "timezone":"Asia/Seoul", "presale_start":"2025-12-01T21:00:00", "presale_end":"2026-01-01T21:00:00" }
        const tz = p.timezone || 'Asia/Seoul';
        const s = p.presale_start ? new Date(p.presale_start.replace('Z','')) : null;
        const e = p.presale_end   ? new Date(p.presale_end.replace('Z',''))   : null;
        if(!s || !e){ $('#countdown').textContent='—'; return; }

        const range=$('#countdown-range'),count=$('#countdown');
        const fmt = (d)=> d.toLocaleString('ko-KR',{timeZone: tz});
        range.textContent = `${fmt(s)} → ${fmt(e)}`;

        const tick=()=>{
          const now=new Date();
          let t=s-now; if(t<0) t=e-now; if(t<=0){ count.textContent='—'; return; }
          const d=Math.floor(t/86400000); t%=86400000;
          const h=Math.floor(t/3600000);  t%=3600000;
          const m=Math.floor(t/60000);    t%=60000;
          const s2=Math.floor(t/1000);
          count.textContent = `${d}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s2).padStart(2,'0')}`;
        };
        tick(); setInterval(tick,1000);
      }catch(e){ $('#countdown').textContent='—'; }
    }

    (async()=>{
      await initLinks();
      await initTokenomics();
      await initCountdown();
    })();
  </script>
</body>
</html>
