<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flexcoin — $FLEX</title>
  <meta name="theme-color" content="#14110b"/>
  <style>
    body{background:#0e0b07;color:#f6e9c0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Noto Sans',sans-serif;margin:0; padding-top:56px}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    h1,h2,h3{color:#f4d03f;margin:12px 0}
    .panel{background:#13100b;border:1px solid #312b1f;border-radius:16px;padding:20px;margin:18px 0;box-shadow:0 0 0 1px rgba(255,255,255,.02) inset}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .btn{display:inline-block;border-radius:12px;padding:10px 14px;background:#6b5b2b;color:#fff;text-decoration:none;font-weight:700}
    .btn[disabled]{opacity:.5;pointer-events:none}
    ul{list-style:none;padding:0;margin:8px 0}
    li{margin:6px 0}
    .gallery{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .tile{border-radius:16px;overflow:hidden;background:#1b160e}
    .tile img{display:block;width:100%;height:160px;object-fit:cover;cursor:zoom-in}
    .muted{opacity:.85}
    a{color:#f0da80}
    footer{opacity:.6;font-size:.9rem;padding:24px 0}
    /* Top-right bar */
    .site-topbar{position:fixed; top:10px; left:0; right:0; z-index:50; display:flex; align-items:center; gap:8px; padding:0 14px}
    .site-topbar .spacer{flex:1}
    .site-topbar .btn{padding:8px 12px}
    /* Lightbox */
    #lightbox{display:none; position:fixed; inset:0; z-index:60; background:rgba(0,0,0,.85); align-items:center; justify-content:center}
    #lightbox img{max-width:92vw;max-height:88vh;border-radius:16px}
  </style>
  <link rel="stylesheet" href="/styles/trust.css">
</head>
<body>
  <!-- site top bar -->
  <div class="site-topbar">
    <div class="spacer"></div>
    <a class="btn" href="https://x.com/Flexcoinmeme" target="_blank" rel="noopener">X</a>
    <a class="btn" href="https://t.me/+p1BMrdypmDFmNTA1" target="_blank" rel="noopener">TG</a>
    <a class="btn" href="https://pancakeswap.finance/swap?outputCurrency=0xBa29562241F0489504C493c47aCBA16d7a98998f&chainId=56" target="_blank" rel="noopener">Buy $FLEX</a>
    <div class="lang-switch">
      <button class="btn" data-lang="en">EN</button>
      <button class="btn" data-lang="ko">KR</button>
    </div>
  </div>

  <div class="wrap">
    <div id="trust-transparency"></div>
    <h1>Flexcoin — $FLEX</h1>
    <img id="hero-img" alt="Hero" style="width:100%;border-radius:16px;display:block" />

    <section class="panel">
      <h2 data-i18n="section_tokenomics">Tokenomics</h2>
      <div class="grid">
        <div>
          <svg id="donut" viewBox="0 0 120 120" width="180" height="180"></svg>
          <ul class="muted">
            <li>LP: <b data-tok-lp>—</b></li>
            <li>Presale: <b data-tok-presale>—</b></li>
            <li>Team: <b data-tok-team>—</b></li>
            <li>Marketing: <b data-tok-mkt>—</b></li>
            <li>Burn: <b data-tok-burn>—</b></li>
          </ul>
          <div class="rates muted">
            <div data-presale-rate>—</div>
            <div data-listing-rate>—</div>
            <div>Softcap: <b data-softcap>—</b> / Hardcap: <b data-hardcap>—</b></div>
          </div>
          <p><a id="btn-pinksale" class="btn disabled">Pinksale (coming soon)</a></p>
        </div>
        <div>
          <h3>Addresses</h3>
          <ul>
            <li><a data-addr-token target="_blank" rel="noopener">Token</a></li>
            <li><a data-addr-team target="_blank" rel="noopener">Team/Lock</a></li>
            <li><a data-addr-mkt target="_blank" rel="noopener">Marketing</a></li>
            <li><a data-addr-presale target="_blank" rel="noopener">Presale</a></li>
            <li><a data-addr-burn target="_blank" rel="noopener">Burn</a></li>
            <li><a data-addr-user target="_blank" rel="noopener">User</a></li>
          </ul>
        </div>
      </div>
    </section>

    <section class="panel">
      <h2>Action Preview</h2>
      <div class="gallery">
        <div class="tile"><img src="/action/1.jpg" alt=""></div>
        <div class="tile"><img src="/action/2.jpg" alt=""></div>
        <div class="tile"><img src="/action/3.jpg" alt=""></div>
        <div class="tile"><img src="/action/4.jpg" alt=""></div>
        <div class="tile"><img src="/action/5.jpg" alt=""></div>
        <div class="tile"><img src="/action/6.jpg" alt=""></div>
        <div class="tile"><img src="/action/7.jpg" alt=""></div>
        <div class="tile"><img src="/action/8.jpg" alt=""></div>
      </div>
    </section>

    <section class="panel">
      <h2 data-i18n="nft.title">NFT Preview</h2>
      <div class="gallery">
        <div class="tile"><img src="/nft-preview/1.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/2.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/3.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/4.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/5.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/6.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/7.jpg" alt=""></div>
        <div class="tile"><img src="/nft-preview/8.jpg" alt=""></div>
      </div>
      <p class="muted" data-i18n="nft.note">Upload 1..8.jpg (1600×900) to /public/nft-preview/</p>
      <p><button id="btn-mint" class="btn">Mint NFT</button></p>
    </section>

    <section class="panel">
      <h2>Whitepaper</h2>
      <ul class="gallery" style="grid-template-columns:repeat(4,1fr)">
        <li class="tile"><a href="/whitepaper/en.pdf" class="btn" download>English</a></li>
        <li class="tile"><a href="/whitepaper/ko.pdf" class="btn" download>Korean</a></li>
        <li class="tile"><a href="/whitepaper/ja.pdf" class="btn" download>Japanese</a></li>
        <li class="tile"><a href="/whitepaper/zh.pdf" class="btn" download>Chinese</a></li>
        <li class="tile"><a href="/whitepaper/es.pdf" class="btn" download>Spanish</a></li>
        <li class="tile"><a href="/whitepaper/de.pdf" class="btn" download>German</a></li>
        <li class="tile"><a href="/whitepaper/pt.pdf" class="btn" download>Portuguese</a></li>
        <li class="tile"><a href="/whitepaper/it.pdf" class="btn" download>Italian</a></li>
      </ul>
    </section>

    <footer class="muted">Flexcoin V5.9 • Runtime JSON • Vite • GitHub Pages</footer>
  </div>

  <!-- Lightbox -->
  <div id="lightbox"><img id="lightbox-img" alt="preview"></div>
  <script>
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lightbox-img');
    function openLB(src){ lbImg.src = src; lb.style.display='flex'; }
    function closeLB(){ lb.style.display='none'; lbImg.src=''; }
    lb.addEventListener('click', closeLB);
    addEventListener('DOMContentLoaded',()=>{
      document.querySelectorAll('.gallery img').forEach(img=>{
        img.addEventListener('click', ()=> openLB(img.src));
      });
    });
  </script>

  <!-- i18n loader (public/i18n/*.json) -->
  <script>
    async function setLang(lang){
      try{
        const dict = await (await fetch(`/i18n/${lang}.json`,{cache:"no-cache"})).json();
        document.querySelectorAll("[data-i18n]").forEach(el=>{
          const k = el.getAttribute("data-i18n");
          if (k && dict[k]) el.textContent = dict[k];
        });
        localStorage.setItem("lang", lang);
      }catch{}
    }
    const wanted = new URL(location.href).searchParams.get("lang") || localStorage.getItem("lang") || "en";
    setLang(wanted);
    addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll("[data-lang]").forEach(btn=>{
        btn.addEventListener("click", ()=> setLang(btn.dataset.lang || "en"));
      });
    });
  </script>

  <!-- main.ts (Vite) -->
  <script type="module" src="/src/main.ts"></script>

  <!-- ethers via CDN (번들 불필요) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <script>
    const NFT_ABI = [
      "function mint(uint256 qty) payable",
      "function price() view returns (uint256)"
    ];
    async function readNftCfg(){
      const r = await fetch("/config/nft.json",{cache:"no-cache"});
      return r.json();
    }
    async function mintNft(qty=1){
      const cfg = await readNftCfg();
      if(!window.ethereum){ alert("Wallet not found"); return; }
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const [acc] = await provider.send("eth_requestAccounts",[]);
      const net = await provider.getNetwork();
      if (Number(net.chainId) !== Number(cfg.chainId)){
        await window.ethereum.request({
          method:"wallet_switchEthereumChain",
          params:[{ chainId:"0x"+Number(cfg.chainId).toString(16) }]
        });
      }
      const signer = provider.getSigner(acc);
      const c = new ethers.Contract(cfg.contract, NFT_ABI, signer);
      const unit = cfg.priceEth ? ethers.utils.parseEther(cfg.priceEth) : await c.price();
      const want = Math.min(qty, cfg.maxPerTx || qty);
      const tx = await c.mint(want, { value: unit.mul(want) });
      await tx.wait();
      alert("Mint success!");
    }
    document.addEventListener("DOMContentLoaded", ()=>{
      const btn = document.getElementById("btn-mint");
      if (btn) btn.addEventListener("click", ()=> mintNft(1));
    });
  </script>
  <script type="module" src="/src/trust.ts"></script>
</body>
</html>
